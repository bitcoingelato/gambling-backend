<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Bitcoin Gelato Casino</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: Arial, sans-serif; background: #1a1a1a; color: #fff; margin: 0; padding: 10px; }
        .container { max-width: 500px; margin: 0 auto; }
        .header { background: #212121; padding: 16px; text-align: center; border-radius: 10px; margin-bottom: 20px; }
        .hidden { display: none !important; }
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.88); display: flex; justify-content: center; align-items: center; z-index: 1000; }
        .modal-content { background: #333; padding: 28px 24px; width: 320px; text-align: center; border-radius: 12px; }
        .modal-tabs { display: flex; margin-bottom: 20px; }
        .modal-tab { flex: 1; padding: 10px; cursor: pointer; color: #FFC107; font-weight: bold; }
        .modal-tab.active { color: #fff; border-bottom: 2px solid #FFC107; }
        .modal-content input, .modal-content button { width: 100%; padding: 10px; margin: 12px 0; background: #444; color: #fff; border: 1px solid #FFC107; border-radius: 6px; }
        .modal-content button { background: #FFC107; color: #000; border: none; font-weight: bold; cursor: pointer; }
        .error { color: #FF5252; font-size: 0.98em; margin-top: 5px; }
        .success { color: #00e676; font-size: 0.98em; margin-top: 5px; }
        .footer {text-align:center;font-size:0.9em; color:#888; margin-top: 20px;}
    </style>
</head>
<body>
    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-tabs">
                <div id="loginTab" class="modal-tab active">Login</div>
                <div id="signupTab" class="modal-tab">Sign Up</div>
            </div>
            <div id="loginForm">
                <input type="text" id="loginUsername" placeholder="Username" autocomplete="username">
                <input type="password" id="loginPassword" placeholder="Password" autocomplete="current-password">
                <button id="loginButton" type="button">Login</button>
                <p id="loginError" class="error hidden"></p>
            </div>
            <div id="signupForm" class="hidden">
                <input type="text" id="signupUsername" placeholder="Username" autocomplete="username">
                <input type="email" id="signupEmail" placeholder="Email" autocomplete="email">
                <input type="password" id="signupPassword" placeholder="Password" autocomplete="new-password">
                <input type="password" id="signupConfirmPassword" placeholder="Confirm Password" autocomplete="new-password">
                <button id="signupButton" type="button">Sign Up</button>
                <p id="signupError" class="error hidden"></p>
            </div>
        </div>
    </div>
    <div id="gameInterface" class="hidden">
        <div class="header">
            <span>Welcome, <span id="headerUsername" class="username">Guest</span></span>
            <button id="logoutButton" style="float:right;background:#FFC107;color:#222;border-radius:5px;font-weight:bold;">Logout</button>
        </div>
        <div class="container">
            <h2>Main Game Page</h2>
            <p>You are now logged in to Bitcoin Gelato Casino!</p>
        </div>
        <div class="footer">
            &copy; 2025 Bitcoin Gelato Casino | Play responsibly.
        </div>
    </div>
<script>
const API = "http://localhost:3000"; // Change to your deployed backend if needed
let authToken = localStorage.getItem('token') || null;

// Modal tab logic
document.getElementById('loginTab').onclick = function() {
    document.getElementById('loginTab').classList.add('active');
    document.getElementById('signupTab').classList.remove('active');
    document.getElementById('loginForm').classList.remove('hidden');
    document.getElementById('signupForm').classList.add('hidden');
};
document.getElementById('signupTab').onclick = function() {
    document.getElementById('signupTab').classList.add('active');
    document.getElementById('loginTab').classList.remove('active');
    document.getElementById('signupForm').classList.remove('hidden');
    document.getElementById('loginForm').classList.add('hidden');
};

// Show/hide
function showGameInterface() {
    document.getElementById('modal').classList.add('hidden');
    document.getElementById('gameInterface').classList.remove('hidden');
    document.getElementById('headerUsername').textContent = localStorage.getItem('username') || 'Guest';
}
function showModal() {
    document.getElementById('modal').classList.remove('hidden');
    document.getElementById('gameInterface').classList.add('hidden');
}

// Signup
document.getElementById('signupButton').onclick = async function(e) {
    e.preventDefault && e.preventDefault();
    const username = document.getElementById('signupUsername').value.trim();
    const email = document.getElementById('signupEmail').value.trim();
    const password = document.getElementById('signupPassword').value;
    const confirm = document.getElementById('signupConfirmPassword').value;
    const errorEl = document.getElementById('signupError');
    errorEl.classList.add('hidden');
    errorEl.textContent = '';
    if (!username || !email || !password || !confirm) {
        errorEl.textContent = 'All fields required.'; errorEl.classList.remove('hidden'); return;
    }
    if (password.length < 6) {
        errorEl.textContent = 'Password must be at least 6 characters.'; errorEl.classList.remove('hidden'); return;
    }
    if (password !== confirm) {
        errorEl.textContent = 'Passwords do not match.'; errorEl.classList.remove('hidden'); return;
    }
    try {
        const res = await fetch(`${API}/api/signup`, {
            method: 'POST',
            headers: {'Content-Type':'application/json'},
            body: JSON.stringify({username, email, password})
        });
        const data = await res.json();
        if (data.success) {
            // Auto-login after signup
            const loginRes = await fetch(`${API}/api/login`, {
                method: 'POST',
                headers: {'Content-Type':'application/json'},
                body: JSON.stringify({username, password})
            });
            const loginData = await loginRes.json();
            if (loginData.success && loginData.token) {
                localStorage.setItem('token', loginData.token);
                localStorage.setItem('username', loginData.username);
                showGameInterface();
            } else {
                errorEl.textContent = loginData.message || 'Signup succeeded but login failed.'; errorEl.classList.remove('hidden');
            }
        } else {
            errorEl.textContent = data.message || 'Signup failed.'; errorEl.classList.remove('hidden');
        }
    } catch (err) {
        errorEl.textContent = 'Network error.'; errorEl.classList.remove('hidden');
        console.error(err);
    }
};

// Login
document.getElementById('loginButton').onclick = async function(e) {
    e.preventDefault && e.preventDefault();
    const username = document.getElementById('loginUsername').value.trim();
    const password = document.getElementById('loginPassword').value;
    const errorEl = document.getElementById('loginError');
    errorEl.classList.add('hidden'); errorEl.textContent = '';
    try {
        const res = await fetch(`${API}/api/login`, {
            method: 'POST',
            headers: {'Content-Type':'application/json'},
            body: JSON.stringify({username, password})
        });
        const data = await res.json();
        if (data.success && data.token) {
            localStorage.setItem('token', data.token);
            localStorage.setItem('username', data.username);
            showGameInterface();
        } else {
            errorEl.textContent = data.message || 'Login failed.'; errorEl.classList.remove('hidden');
        }
    } catch (err) {
        errorEl.textContent = 'Network error.'; errorEl.classList.remove('hidden');
        console.error(err);
    }
};

// Logout
document.getElementById('logoutButton').onclick = function() {
    localStorage.removeItem('token'); localStorage.removeItem('username');
    authToken = null;
    showModal();
};

// On load, show game if logged in
if (authToken && localStorage.getItem('username')) {
    showGameInterface();
} else {
    showModal();
}
</script>
</body>
</html>
