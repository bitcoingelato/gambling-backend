<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bitcoin Gelato</title>
    <style>
        * { box-sizing: border-box; }
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
            color: #333;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #2c3e50;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
        }
        .nav button {
            background: #3498db;
            border: none;
            padding: 8px 15px;
            color: white;
            cursor: pointer;
            border-radius: 3px;
        }
        .nav button:hover { background: #2980b9; }
        #userInfo { display: flex; align-items: center; gap: 10px; }
        .game-menu {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            justify-content: center;
        }
        .game-menu button {
            background: #e74c3c;
            border: none;
            padding: 10px 20px;
            color: white;
            cursor: pointer;
            border-radius: 3px;
        }
        .game-menu button:hover { background: #c0392b; }
        .section { display: none; padding: 20px; background: white; border-radius: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .section.active { display: block; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; }
        .form-group input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 3px;
        }
        .error { color: #e74c3c; font-size: 0.9em; margin-top: 5px; }
        button { background: #2ecc71; border: none; padding: 10px 20px; color: white; cursor: pointer; border-radius: 3px; }
        button:hover { background: #27ae60; }
        .h-captcha { margin: 10px 0; }
        #crashMultiplier { font-size: 2em; color: #27ae60; }
        .crash-controls { margin: 10px 0; }
    </style>
    <script src="https://hcaptcha.com/1/api.js" async defer></script>
</head>
<body>
    <div class="container">
        <div class="nav">
            <div class="auth">
                <button id="loginBtn">Login</button>
                <button id="signupBtn">Sign Up</button>
            </div>
            <div id="userInfo" class="hidden">
                Welcome, <span id="username"></span> | Balance: <span id="balance">0.0000 BTC (Fun Mode)</span>
                <button id="logoutBtn">Logout</button>
            </div>
        </div>

        <div class="game-menu">
            <button onclick="showSection('crash')">Crash</button>
            <button onclick="showSection('coinflip')">Coinflip</button>
            <button onclick="showSection('roulette')">Roulette</button>
            <button onclick="showSection('threecp')">3CP</button>
            <button onclick="showSection('account')">Account</button>
        </div>

        <div id="gameArea">
            <!-- Login Section -->
            <div id="loginSection" class="section">
                <h2>Login</h2>
                <div class="form-group">
                    <label for="loginUsername">Username</label>
                    <input type="text" id="loginUsername" placeholder="Enter Username">
                </div>
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" placeholder="Enter Password">
                </div>
                <button onclick="login()">Login</button>
                <div id="loginError" class="error"></div>
            </div>

            <!-- Signup Section -->
            <div id="signupSection" class="section">
                <h2>Sign Up</h2>
                <div class="form-group">
                    <label for="signupUsername">Username</label>
                    <input type="text" id="signupUsername" placeholder="Choose a Username">
                    <div id="usernameError" class="error"></div>
                </div>
                <div class="form-group">
                    <label for="signupEmail">Email</label>
                    <input type="email" id="signupEmail" placeholder="Enter Email">
                    <div id="emailError" class="error"></div>
                </div>
                <div class="form-group">
                    <label for="signupPassword">Password</label>
                    <input type="password" id="signupPassword" placeholder="Choose a Password">
                    <div id="passwordError" class="error"></div>
                </div>
                <div class="h-captcha" data-sitekey=b1e64024-155e-43da-a5e6-9b56729c337e></div> <!-- Replace with your Site Key -->
                <div id="captchaError" class="error"></div>
                <button id="signupButton" onclick="signup()">Sign Up</button>
                <div id="signupResult" class="error"></div>
            </div>

            <!-- Crash Game -->
            <div id="crashSection" class="section">
                <h2>Crash</h2>
                <div>Multiplier: <span id="crashMultiplier">1.00x</span></div>
                <div class="form-group">
                    <label for="crashBet">Bet Amount (BTC)</label>
                    <input type="number" id="crashBet" placeholder="Enter Bet" min="0.001" step="0.001" value="0.001">
                </div>
                <div class="crash-controls">
                    <button onclick="placeBet()">Place Bet</button>
                    <button id="cancelBetBtn" onclick="cancelBet()" disabled>Cancel Bet</button>
                    <button id="cashoutBtn" onclick="cashOut()" disabled>Cash Out</button>
                    <button onclick="verifyFairness()">Verify Fairness</button>
                </div>
                <div>Next round in <span id="crashTimer">9s</span></div>
                <div>Round History
                    <table>
                        <tr><th>Crash Point</th><th>Round #</th><th>Bet</th><th>Verify</th><th>Time</th></tr>
                    </table>
                </div>
            </div>

            <!-- Other Games (Placeholder) -->
            <div id="coinflipSection" class="section">
                <h2>Coinflip</h2>
            </div>
            <div id="rouletteSection" class="section">
                <h2>Roulette</h2>
            </div>
            <div id="threecpSection" class="section">
                <h2>3 Card Poker (3CP)</h2>
            </div>
            <div id="accountSection" class="section">
                <h2>Account</h2>
            </div>
        </div>
    </div>

    <script>
    let currentUser = null;
    let crashInterval = null;
    let betPlaced = false;
    let currentMultiplier = 1.0;

    function showSection(sectionId) {
        document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
        document.getElementById(sectionId).classList.add('active');
    }

    // ---- LOGIN LOGIC ----
    document.getElementById('loginBtn').addEventListener('click', () => showSection('loginSection'));
    document.getElementById('signupBtn').addEventListener('click', () => showSection('signupSection'));

    document.getElementById('loginSection').querySelector('button').addEventListener('click', function (e) {
        e.preventDefault();
        const username = document.getElementById('loginUsername').value.trim();
        const password = document.getElementById('loginPassword').value;
        const errorDiv = document.getElementById('loginError');
        errorDiv.textContent = '';

        fetch('https://desolate-shore-72677-e0fe07c2f233.herokuapp.com/api/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, password })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                currentUser = username;
                document.getElementById('userInfo').classList.remove('hidden');
                document.getElementById('username').textContent = username;
                document.getElementById('balance').textContent = `${data.balance || 0} BTC (Fun Mode)`;
                showSection('crashSection');
                errorDiv.textContent = '';
            } else {
                errorDiv.textContent = data.message || "Login failed.";
            }
        })
        .catch(() => {
            errorDiv.textContent = "Network error. Please try again.";
        });
    });

    // ---- SIGNUP LOGIC ----
    let signupButton = document.getElementById('signupButton');
    let captchaToken = "";

    // hCaptcha callback (called by hCaptcha when solved)
    window.hcaptchaCallback = function(token) {
        captchaToken = token;
        signupButton.disabled = false;
        document.getElementById('captchaError').textContent = '';
    };

    // Disable signup until captcha is solved
    signupButton.disabled = true;

    signupButton.addEventListener('click', function (e) {
        e.preventDefault();

        // Clear all errors
        ['usernameError', 'emailError', 'passwordError', 'captchaError', 'signupResult'].forEach(id => {
            document.getElementById(id).textContent = '';
        });

        const username = document.getElementById('signupUsername').value.trim();
        const email = document.getElementById('signupEmail').value.trim();
        const password = document.getElementById('signupPassword').value;

        let hasError = false;
        if (!username) {
            document.getElementById('usernameError').textContent = 'Username is required';
            hasError = true;
        }
        if (!email) {
            document.getElementById('emailError').textContent = 'Email is required';
            hasError = true;
        }
        if (!password) {
            document.getElementById('passwordError').textContent = 'Password is required';
            hasError = true;
        } else if (password.length < 6) {
            document.getElementById('passwordError').textContent = 'Password must be at least 6 characters';
            hasError = true;
        }
        if (!captchaToken) {
            document.getElementById('captchaError').textContent = 'Please complete the CAPTCHA';
            hasError = true;
        }

        if (hasError) return;

        signupButton.disabled = true;

        fetch('https://desolate-shore-72677-e0fe07c2f233.herokuapp.com/api/signup', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, email, password, captchaToken })
        })
        .then(response => response.json())
        .then(data => {
            const resultDiv = document.getElementById('signupResult');
            if (data.success) {
                resultDiv.textContent = data.message;
                resultDiv.style.color = 'green';
                // Reset form and move to login
                document.getElementById('signupUsername').value = "";
                document.getElementById('signupEmail').value = "";
                document.getElementById('signupPassword').value = "";
                hcaptcha.reset(); // clear captcha
                captchaToken = "";
                setTimeout(() => {
                    showSection('loginSection');
                    resultDiv.textContent = '';
                }, 1500);
            } else {
                resultDiv.textContent = data.message || "Signup failed.";
                resultDiv.style.color = 'red';
                hcaptcha.reset(); // Allow another attempt
                captchaToken = "";
            }
        })
        .catch(() => {
            document.getElementById('signupResult').textContent = "Network error. Please try again.";
            hcaptcha.reset();
            captchaToken = "";
        })
        .finally(() => {
            signupButton.disabled = true; // always require captcha again
        });
    });

    // hCaptcha render—ensure this matches your site key!
    window.onload = function () {
        showSection('crashSection');
        hcaptcha.render(document.querySelector('.h-captcha'), {
            sitekey: 'b1e64024-155e-43da-a5e6-9b56729c337e', // <-- your site key
            callback: window.hcaptchaCallback,
            'error-callback': function() {
                document.getElementById('captchaError').textContent = 'Error with CAPTCHA, please try again';
            }
        });
    };

    // ---- GAME LOGIC (unchanged) ----
    // ... keep your crash/coinflip/etc. functions here ...
    // (If you want me to re-integrate game logic, let me know!)

</script>
</body>
</html>
